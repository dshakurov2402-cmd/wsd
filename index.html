<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abol Network PRO</title>
    <style>
        :root { --primary: #1d9bf0; --bg: #000; --surface: #16181c; --text: #e7e9ea; --border: #2f3336; }
        body { font-family: Segoe UI, Roboto; background: var(--bg); color: var(--text); margin: 0; }
        
        /* –°—Ç–∏–ª–∏ –≤—Ö–æ–¥–∞ */
        #auth-screen, #admin-panel { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card { background: var(--surface); padding: 30px; border-radius: 16px; width: 320px; box-shadow: 0 0 20px rgba(29, 155, 240, 0.2); }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid var(--border); color: #fff; border-radius: 8px; box-sizing: border-box; }
        .btn { width: 100%; background: var(--primary); color: #fff; border: none; padding: 12px; border-radius: 25px; font-weight: bold; cursor: pointer; }
        
        /* –õ–µ–Ω—Ç–∞ */
        #main-app { max-width: 600px; margin: 0 auto; border-inline: 1px solid var(--border); min-height: 100vh; display: none; }
        header { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; sticky; top: 0; background: rgba(0,0,0,0.8); }
        .logo { font-size: 24px; cursor: pointer; user-select: none; }
        
        .post { padding: 15px; border-bottom: 1px solid var(--border); display: flex; gap: 12px; }
        .avatar { width: 45px; height: 45px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .post-body { flex: 1; }
        .p-user { font-weight: bold; font-size: 15px; }
        .p-text { margin-top: 5px; line-height: 1.4; }

        /* –ê–¥–º–∏–Ω–∫–∞ */
        #admin-panel { display: none; background: #050505; }
        .admin-list { width: 90%; max-width: 500px; overflow-y: auto; }
        .admin-item { background: #1c1c1c; padding: 10px; margin: 5px 0; border-radius: 8px; display: flex; justify-content: space-between; }
        .del-btn { background: #f4212e; color: #fff; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="card">
        <h2 style="text-align:center">Abol Login</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="pass" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn" onclick="handleAuth('login')">–í–æ–π—Ç–∏</button>
        <p style="text-align:center; font-size:12px; color:gray; cursor:pointer" onclick="handleAuth('reg')">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</p>
    </div>
</div>

<div id="admin-panel">
    <h2>–ê–¥–º–∏–Ω-—Ü–µ–Ω—Ç—Ä (Damir OS)</h2>
    <div class="admin-list" id="userList"></div>
    <button class="btn" style="width:200px; margin-top:20px; background:#333" onclick="closeAdmin()">–í—ã–π—Ç–∏ –∏–∑ –ø–∞–Ω–µ–ª–∏</button>
</div>

<div id="main-app">
    <header>
        <span class="logo" onclick="askAdmin()">üÖ∞Ô∏è</span>
        <b>Abol Network</b>
        <button onclick="logout()" style="background:none; border:none; color:gray; cursor:pointer">–í—ã—Ö–æ–¥</button>
    </header>

    <div style="padding:15px; border-bottom:8px solid #202327">
        <textarea id="tweet" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?" style="width:100%; background:none; border:none; color:#fff; font-size:18px; outline:none; resize:none" rows="3"></textarea>
        <button class="btn" style="width:100px; float:right" onclick="post()">–ü–æ—Å—Ç–∏—Ç—å</button>
        <div style="clear:both"></div>
    </div>

    <div id="feed"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, deleteDoc, doc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBz8fnaJ_mpCE5Vv83doxBb6nTybDSBmlI",
        authDomain: "kaka-chat-39bb6.firebaseapp.com",
        projectId: "kaka-chat-39bb6",
        storageBucket: "kaka-chat-39bb6.firebasestorage.app",
        messagingSenderId: "927391255601",
        appId: "1:927391255601:web:1f83128108dc1ca2831910"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // –í–ï–†–ò–§–ò–ö–ê–¶–ò–Ø
    window.handleAuth = async (type) => {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        try {
            if(type === 'reg') await createUserWithEmailAndPassword(auth, email, pass);
            else await signInWithEmailAndPassword(auth, email, pass);
        } catch (e) { alert("–û—à–∏–±–∫–∞: " + e.message); }
    };

    onAuthStateChanged(auth, user => {
        if (user) {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            loadFeed();
        } else {
            document.getElementById('auth-screen').style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
        }
    });

    window.logout = () => signOut(auth);

    // –ü–û–°–¢–´
    window.post = async () => {
        const txt = document.getElementById('tweet').value;
        if(!txt) return;
        await addDoc(collection(db, "posts"), {
            uid: auth.currentUser.uid,
            email: auth.currentUser.email,
            text: txt,
            at: serverTimestamp()
        });
        document.getElementById('tweet').value = "";
    };

    function loadFeed() {
        const q = query(collection(db, "posts"), orderBy("at", "desc"));
        onSnapshot(q, (snap) => {
            const feed = document.getElementById('feed');
            feed.innerHTML = "";
            snap.forEach(pDoc => {
                const p = pDoc.data();
                feed.innerHTML += `
                    <div class="post">
                        <div class="avatar">${p.email[0].toUpperCase()}</div>
                        <div class="post-body">
                            <div class="p-user">${p.email}</div>
                            <div class="p-text">${p.text}</div>
                        </div>
                    </div>`;
            });
        });
    }

    // –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨
    window.askAdmin = () => {
        const p = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:");
        if (p === "3232damir4ik") {
            document.getElementById('admin-panel').style.display = 'flex';
            loadAdminData();
        } else {
            alert("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω!");
        }
    };

    async function loadAdminData() {
        const list = document.getElementById('userList');
        list.innerHTML = "<h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–º–∏ (–í—Å–µ –ø–æ—Å—Ç—ã):</h3>";
        const q = await getDocs(collection(db, "posts"));
        q.forEach(d => {
            list.innerHTML += `
                <div class="admin-item">
                    <span>${d.data().email}: ${d.data().text.substring(0,20)}...</span>
                    <button class="del-btn" onclick="delPost('${d.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                </div>`;
        });
    }

    window.delPost = async (id) => {
        await deleteDoc(doc(db, "posts", id));
        loadAdminData();
    };

    window.closeAdmin = () => {
        document.getElementById('admin-panel').style.display = 'none';
    };
</script>
</body>
</html>
