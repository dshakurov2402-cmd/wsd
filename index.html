<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Abol Network v4.0</title>
    <style>
        :root { --primary: #1d9bf0; --bg: #000; --surface: #16181c; --text: #e7e9ea; --border: #2f3336; --red: #f4212e; }
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        #app-container { width: 100%; max-width: 600px; border-left: 1px solid var(--border); border-right: 1px solid var(--border); min-height: 100vh; position: relative; display: none; }
        
        /* –í—Ö–æ–¥ */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: var(--surface); padding: 30px; border-radius: 20px; width: 100%; max-width: 350px; text-align: center; box-shadow: 0 0 30px rgba(29,155,240,0.1); }
        input, textarea { width: 100%; padding: 14px; margin: 10px 0; background: #000; border: 1px solid var(--border); color: #fff; border-radius: 10px; font-size: 16px; outline: none; transition: 0.2s; }
        input:focus { border-color: var(--primary); }
        .btn { background: var(--primary); color: #fff; border: none; padding: 14px; border-radius: 30px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        
        /* –®–∞–ø–∫–∞ */
        header { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; sticky; top: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 100; }
        .logo { font-size: 26px; cursor: pointer; filter: drop-shadow(0 0 5px var(--primary)); }

        /* –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ */
        .tweet-box { padding: 15px; border-bottom: 8px solid #202327; }
        .tweet-box textarea { background: none; border: none; font-size: 20px; resize: none; padding: 0; margin-bottom: 5px; }
        .tweet-box input { padding: 8px; font-size: 14px; border-style: dashed; }

        /* –õ–µ–Ω—Ç–∞ */
        .post { padding: 15px; border-bottom: 1px solid var(--border); display: flex; gap: 12px; transition: 0.2s; }
        .post:hover { background: rgba(255,255,255,0.02); }
        .avatar { width: 48px; height: 48px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; flex-shrink: 0; }
        .post-body { flex: 1; }
        .post-user { font-weight: bold; font-size: 15px; margin-bottom: 4px; }
        .post-text { font-size: 15px; line-height: 1.5; white-space: pre-wrap; }
        .post-img { width: 100%; border-radius: 16px; margin-top: 12px; border: 1px solid var(--border); max-height: 400px; object-fit: cover; }

        /* –ê–¥–º–∏–Ω–∫–∞ */
        #admin-screen { display: none; position: fixed; inset: 0; background: #000; z-index: 9000; padding: 20px; overflow-y: auto; }
        .admin-item { background: var(--surface); padding: 15px; margin: 10px 0; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }
        .ban-btn { background: var(--red); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω */
        @media (max-width: 600px) {
            #app-container { border: none; }
            header { padding: 10px 15px; }
        }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-card">
        <h1 style="color:var(--primary); margin-bottom: 5px;">Abol</h1>
        <p style="color: gray; font-size: 14px; margin-bottom: 20px;">–í—Ö–æ–¥ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</p>
        <input type="text" id="login-id" placeholder="–¢–≤–æ–π –Ω–∏–∫–Ω–µ–π–º">
        <input type="password" id="login-pw" placeholder="–¢–≤–æ–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –ø–∞—Ä–æ–ª—å">
        <button class="btn" id="entry-btn">–í–æ–π—Ç–∏ –≤ —Å–µ—Ç—å</button>
    </div>
</div>

<div id="admin-screen">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2>Abol Admin Console</h2>
        <button class="btn" style="width:100px; background:#333;" onclick="closeAdmin()">X</button>
    </div>
    <div id="admin-users"></div>
</div>

<div id="app-container">
    <header>
        <span class="logo" onclick="adminAccess()">üÖ∞Ô∏è</span>
        <b id="my-handle">@user</b>
        <span onclick="location.reload()" style="font-size: 14px; color: var(--red); cursor:pointer;">–í—ã–π—Ç–∏</span>
    </header>

    <div class="tweet-box">
        <textarea id="post-text" placeholder="–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?" rows="3"></textarea>
        <input type="text" id="post-image" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (jpg, png, gif)...">
        <div style="display:flex; justify-content:flex-end; margin-top:10px;">
            <button class="btn" style="width:130px; margin:0;" id="post-btn">–ü–æ—Å—Ç–∏—Ç—å</button>
        </div>
    </div>

    <div id="main-feed"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, getDocs, where, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBz8fnaJ_mpCE5Vv83doxBb6nTybDSBmlI",
        authDomain: "kaka-chat-39bb6.firebaseapp.com",
        projectId: "kaka-chat-39bb6",
        storageBucket: "kaka-chat-39bb6.firebasestorage.app",
        messagingSenderId: "927391255601",
        appId: "1:927391255601:web:1f83128108dc1ca2831910"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let myUser = "";

    // –ö–ù–û–ü–ö–ê –í–•–û–î–ê / –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò
    document.getElementById('entry-btn').onclick = async () => {
        const u = document.getElementById('login-id').value.trim().toLowerCase();
        const p = document.getElementById('login-pw').value.trim();
        if(!u || !p) return alert("–í–≤–µ–¥–∏ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!");

        const userCol = collection(db, "users");
        const q = query(userCol, where("login", "==", u));
        const snap = await getDocs(q);

        if(snap.empty) {
            // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            await addDoc(userCol, { login: u, pass: p });
            alert("–ê–∫–∫–∞—É–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω! –ñ–º–∏ '–í–æ–π—Ç–∏' –µ—â–µ —Ä–∞–∑.");
        } else {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
            let correct = false;
            snap.forEach(d => { if(d.data().pass === p) correct = true; });
            if(correct) {
                myUser = u;
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app-container').style.display = 'block';
                document.getElementById('my-handle').innerText = "@" + u;
                startApp();
            } else {
                alert("–û—à–∏–±–∫–∞: –≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ, –∏–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π!");
            }
        }
    };

    // –ü–û–°–¢–ò–ù–ì (–¢–ï–ö–°–¢ + –§–û–¢–û)
    document.getElementById('post-btn').onclick = async () => {
        const txt = document.getElementById('post-text').value.trim();
        const img = document.getElementById('post-image').value.trim();
        
        if(!txt && !img) return;

        await addDoc(collection(db, "posts"), {
            user: myUser,
            content: txt,
            image: img,
            time: serverTimestamp()
        });

        document.getElementById('post-text').value = "";
        document.getElementById('post-image').value = "";
    };

    function startApp() {
        const q = query(collection(db, "posts"), orderBy("time", "desc"));
        onSnapshot(q, (snap) => {
            const feed = document.getElementById('main-feed');
            feed.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                feed.innerHTML += `
                    <div class="post">
                        <div class="avatar">${data.user[0].toUpperCase()}</div>
                        <div class="post-body">
                            <div class="post-user">@${data.user}</div>
                            ${data.content ? `<div class="post-text">${data.content}</div>` : ''}
                            ${data.image ? `<img src="${data.image}" class="post-img" onerror="this.style.display='none'">` : ''}
                        </div>
                    </div>`;
            });
        });
    }

    // –ê–î–ú–ò–ù–ö–ê
    window.adminAccess = () => {
        const pass = prompt("PASSWORD ADMIN:");
        if(pass === "3232damir4ik") {
            document.getElementById('admin-screen').style.display = 'block';
            loadAdminUsers();
        }
    };

    async function loadAdminUsers() {
        const box = document.getElementById('admin-users');
        box.innerHTML = "<h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>";
        const snap = await getDocs(collection(db, "users"));
        snap.forEach(d => {
            box.innerHTML += `
                <div class="admin-item">
                    <span><b>@${d.data().login}</b> (PW: ${d.data().pass})</span>
                    <button class="ban-btn" onclick="deleteUser('${d.id}')">–£–î–ê–õ–ò–¢–¨</button>
                </div>`;
        });
    }

    window.deleteUser = async (id) => {
        if(confirm("–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç –Ω–∞–≤—Å–µ–≥–¥–∞?")) {
            await deleteDoc(doc(db, "users", id));
            loadAdminUsers();
        }
    };

    window.closeAdmin = () => document.getElementById('admin-screen').style.display = 'none';
</script>

</body>
</html>
