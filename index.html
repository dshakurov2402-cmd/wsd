<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abol Network - WORKING</title>
    <style>
        :root { --primary: #1d9bf0; --bg: #000; --surface: #16181c; --text: #e7e9ea; --border: #2f3336; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; overflow-x: hidden; }
        
        /* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .card { background: var(--surface); padding: 30px; border-radius: 16px; width: 320px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid var(--border); color: #fff; border-radius: 8px; box-sizing: border-box; outline: none; }
        .btn { width: 100%; background: var(--primary); color: #fff; border: none; padding: 12px; border-radius: 25px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        /* –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */
        #main-app { max-width: 600px; margin: 0 auto; border-inline: 1px solid var(--border); min-height: 100vh; display: none; }
        header { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.9); position: sticky; top: 0; z-index: 100; }
        .logo { font-size: 24px; cursor: pointer; }
        
        /* –ü–æ—Å—Ç—ã */
        .post { padding: 15px; border-bottom: 1px solid var(--border); display: flex; gap: 12px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        .avatar { width: 48px; height: 48px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary); flex-shrink: 0; }
        .post-body { flex: 1; }
        .p-user { font-weight: bold; margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }
        .p-text { line-height: 1.4; word-break: break-word; }

        /* –ê–¥–º–∏–Ω–∫–∞ */
        #admin-panel { display: none; position: fixed; inset: 0; background: #050505; z-index: 3000; padding: 20px; overflow-y: auto; }
        .admin-item { background: #1c1c1c; padding: 12px; margin: 8px 0; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        .del-btn { background: #f4212e; color: #fff; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="card">
        <h1 style="color:var(--primary)">Abol</h1>
        <input type="text" id="user-login" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
        <input type="password" id="user-pass" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
        <button class="btn" onclick="authAction('login')">–í–æ–π—Ç–∏</button>
        <button class="btn" style="background:#222" onclick="authAction('reg')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
    </div>
</div>

<div id="admin-panel">
    <div style="display:flex; justify-content:space-between; align-items:center">
        <h2>–ê–¥–º–∏–Ω-—Ü–µ–Ω—Ç—Ä Damir</h2>
        <button class="btn" style="width:100px; background:#333" onclick="closeAdmin()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
    <div id="admin-content"></div>
</div>

<div id="main-app">
    <header>
        <span class="logo" onclick="openAdmin()">üÖ∞Ô∏è</span>
        <b id="display-name">–õ–µ–Ω—Ç–∞</b>
        <button onclick="location.reload()" style="background:none; border:none; color:gray; cursor:pointer">–í—ã–π—Ç–∏</button>
    </header>

    <div style="padding:15px; border-bottom:8px solid #202327">
        <textarea id="tweet-text" placeholder="–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?" style="width:100%; background:none; border:none; color:#fff; font-size:19px; outline:none; resize:none" rows="3"></textarea>
        <div style="display:flex; justify-content:flex-end">
            <button class="btn" style="width:120px" onclick="sendTweet()">–¢–≤–∏—Ç–Ω—É—Ç—å</button>
        </div>
    </div>

    <div id="feed"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, getDocs, where, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBz8fnaJ_mpCE5Vv83doxBb6nTybDSBmlI",
        authDomain: "kaka-chat-39bb6.firebaseapp.com",
        projectId: "kaka-chat-39bb6",
        storageBucket: "kaka-chat-39bb6.firebasestorage.app",
        messagingSenderId: "927391255601",
        appId: "1:927391255601:web:1f83128108dc1ca2831910"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let myUser = null;
    let isAdmin = false;

    // –ö–ê–°–¢–û–ú–ù–ê–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
    window.authAction = async (mode) => {
        const user = document.getElementById('user-login').value.trim().toLowerCase();
        const pass = document.getElementById('user-pass').value.trim();
        if(!user || !pass) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");

        const userRef = collection(db, "users");
        const q = query(userRef, where("login", "==", user));
        const snap = await getDocs(q);

        if (mode === 'reg') {
            if(!snap.empty) return alert("–õ–æ–≥–∏–Ω –∑–∞–Ω—è—Ç!");
            await addDoc(userRef, { login: user, pass: pass, at: serverTimestamp() });
            alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –∂–º–∏ –í–æ–π—Ç–∏.");
        } else {
            let found = false;
            snap.forEach(d => { if(d.data().pass === pass) found = true; });
            if(found) {
                myUser = user;
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                document.getElementById('display-name').innerText = "@" + user;
                loadTweets();
            } else { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!"); }
        }
    };

    // –ü–û–°–¢–ò–ù–ì
    window.sendTweet = async () => {
        const val = document.getElementById('tweet-text').value.trim();
        if(!val) return;
        await addDoc(collection(db, "posts"), {
            user: myUser,
            text: val,
            at: serverTimestamp()
        });
        document.getElementById('tweet-text').value = "";
    };

    function loadTweets() {
        const q = query(collection(db, "posts"), orderBy("at", "desc"));
        onSnapshot(q, (snap) => {
            const feed = document.getElementById('feed');
            feed.innerHTML = "";
            snap.forEach(doc => {
                const p = doc.data();
                feed.innerHTML += `
                    <div class="post">
                        <div class="avatar">${p.user[0].toUpperCase()}</div>
                        <div class="post-body">
                            <div class="p-user">@${p.user}</div>
                            <div class="p-text">${p.text}</div>
                        </div>
                    </div>`;
            });
        });
    }

    // –ê–î–ú–ò–ù–ö–ê
    window.openAdmin = () => {
        const p = prompt("PASSWORD ADMIN:");
        if (p === "3232damir4ik") {
            isAdmin = true;
            document.getElementById('admin-panel').style.display = 'block';
            refreshAdmin();
        }
    };

    async function refreshAdmin() {
        const cont = document.getElementById('admin-content');
        cont.innerHTML = "<h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º:</h3>";
        const q = await getDocs(collection(db, "posts"));
        q.forEach(d => {
            cont.innerHTML += `
                <div class="admin-item">
                    <span><b>${d.data().user}</b>: ${d.data().text.substring(0,30)}...</span>
                    <button class="del-btn" onclick="killPost('${d.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                </div>`;
        });
    }

    window.killPost = async (id) => {
        await deleteDoc(doc(db, "posts", id));
        refreshAdmin();
    };

    window.closeAdmin = () => {
        document.getElementById('admin-panel').style.display = 'none';
    };
</script>
</body>
</html>
