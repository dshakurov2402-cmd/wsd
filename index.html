<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Abol Network v4.5 - FIXED</title>
    <style>
        :root { --primary: #1d9bf0; --bg: #000; --surface: #16181c; --text: #e7e9ea; --border: #2f3336; --red: #f4212e; }
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; }
        
        #app-container { width: 100%; max-width: 600px; border-left: 1px solid var(--border); border-right: 1px solid var(--border); min-height: 100vh; display: none; }
        
        /* –í—Ö–æ–¥ */
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: var(--surface); padding: 30px; border-radius: 20px; width: 100%; max-width: 350px; text-align: center; }
        input, textarea { width: 100%; padding: 14px; margin: 10px 0; background: #000; border: 1px solid var(--border); color: #fff; border-radius: 10px; font-size: 16px; outline: none; }
        .btn { background: var(--primary); color: #fff; border: none; padding: 14px; border-radius: 30px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; margin-top: 10px; }
        
        header { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: rgba(0,0,0,0.9); z-index: 100; }
        .logo { font-size: 26px; cursor: pointer; }

        .tweet-box { padding: 15px; border-bottom: 8px solid #202327; }
        .tweet-box textarea { background: none; border: none; font-size: 20px; resize: none; margin: 0; }
        .tweet-box input { padding: 8px; font-size: 14px; border: 1px dashed var(--border); }

        /* –ü–æ—Å—Ç—ã */
        .post { padding: 15px; border-bottom: 1px solid var(--border); display: flex; gap: 12px; }
        .avatar { width: 48px; height: 48px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; flex-shrink: 0; }
        .post-body { flex: 1; }
        .post-user { font-weight: bold; font-size: 15px; margin-bottom: 5px; color: #fff; }
        .post-text { font-size: 15px; line-height: 1.5; white-space: pre-wrap; margin-bottom: 10px; }
        .post-img { width: 100%; border-radius: 16px; border: 1px solid var(--border); max-height: 450px; object-fit: cover; margin-top: 5px; }

        #admin-screen { display: none; position: fixed; inset: 0; background: #000; z-index: 9000; padding: 20px; overflow-y: auto; }
        .admin-item { background: var(--surface); padding: 15px; margin: 10px 0; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-card">
        <h1 style="color:var(--primary);">Abol</h1>
        <input type="text" id="login-id" placeholder="–ù–∏–∫–Ω–µ–π–º">
        <input type="password" id="login-pw" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn" id="entry-btn">–í–æ–π—Ç–∏ / –°–æ–∑–¥–∞—Ç—å</button>
    </div>
</div>

<div id="admin-screen">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2>Admin Console</h2>
        <button class="btn" style="width:80px;" onclick="closeAdmin()">X</button>
    </div>
    <div id="admin-users"></div>
</div>

<div id="app-container">
    <header>
        <span class="logo" onclick="adminAccess()">üÖ∞Ô∏è</span>
        <b id="my-handle">@user</b>
        <span onclick="location.reload()" style="color:var(--red); cursor:pointer;">–í—ã—Ö–æ–¥</span>
    </header>

    <div class="tweet-box">
        <textarea id="post-text" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?" rows="3"></textarea>
        <input type="text" id="post-image" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
        <div style="display:flex; justify-content:flex-end; margin-top:10px;">
            <button class="btn" style="width:120px; margin:0;" id="post-btn">–ü–æ—Å—Ç–∏—Ç—å</button>
        </div>
    </div>

    <div id="main-feed"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, getDocs, where, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBz8fnaJ_mpCE5Vv83doxBb6nTybDSBmlI",
        authDomain: "kaka-chat-39bb6.firebaseapp.com",
        projectId: "kaka-chat-39bb6",
        storageBucket: "kaka-chat-39bb6.firebasestorage.app",
        messagingSenderId: "927391255601",
        appId: "1:927391255601:web:1f83128108dc1ca2831910"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let myUser = "";

    document.getElementById('entry-btn').onclick = async () => {
        const u = document.getElementById('login-id').value.trim().toLowerCase();
        const p = document.getElementById('login-pw').value.trim();
        if(!u || !p) return;

        const q = query(collection(db, "users"), where("login", "==", u));
        const snap = await getDocs(q);

        if(snap.empty) {
            await addDoc(collection(db, "users"), { login: u, pass: p });
            alert("–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –ó–∞—Ö–æ–¥–∏.");
        } else {
            let auth = false;
            snap.forEach(d => { if(d.data().pass === p) auth = true; });
            if(auth) {
                myUser = u;
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app-container').style.display = 'block';
                document.getElementById('my-handle').innerText = "@" + u;
                startApp();
            } else alert("–ò–º—è –∑–∞–Ω—è—Ç–æ –∏–ª–∏ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π!");
        }
    };

    document.getElementById('post-btn').onclick = async () => {
        const txt = document.getElementById('post-text').value.trim();
        const img = document.getElementById('post-image').value.trim();
        
        if(!txt && !img) return alert("–ù–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—É—Å—Ç–æ–π –ø–æ—Å—Ç!");

        await addDoc(collection(db, "posts"), {
            user: myUser,
            content: txt,
            image: img,
            time: serverTimestamp()
        });

        document.getElementById('post-text').value = "";
        document.getElementById('post-image').value = "";
    };

    function startApp() {
        onSnapshot(query(collection(db, "posts"), orderBy("time", "desc")), (snap) => {
            const feed = document.getElementById('main-feed');
            feed.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                if(!data.content && !data.image) return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Å—Ç–∞—Ä—ã–µ –ø—É—Å—Ç—ã–µ –ø–æ—Å—Ç—ã
                
                feed.innerHTML += `
                    <div class="post">
                        <div class="avatar">${data.user[0].toUpperCase()}</div>
                        <div class="post-body">
                            <div class="post-user">@${data.user}</div>
                            ${data.content ? `<div class="post-text">${data.content}</div>` : ''}
                            ${data.image ? `<img src="${data.image}" class="post-img" onerror="this.style.display='none'">` : ''}
                        </div>
                    </div>`;
            });
        });
    }

    window.adminAccess = () => {
        if(prompt("PASS:") === "3232damir4ik") {
            document.getElementById('admin-screen').style.display = 'block';
            loadAdmin();
        }
    };

    async function loadAdmin() {
        const box = document.getElementById('admin-users');
        box.innerHTML = "<h4>Users & Control</h4>";
        const snap = await getDocs(collection(db, "users"));
        snap.forEach(d => {
            box.innerHTML += `<div class="admin-item"><span>@${d.data().login}</span>
            <button class="btn" style="width:80px; background:var(--red);" onclick="delU('${d.id}')">BAN</button></div>`;
        });
    }

    window.delU = async (id) => { await deleteDoc(doc(db, "users", id)); loadAdmin(); };
    window.closeAdmin = () => document.getElementById('admin-screen').style.display = 'none';
</script>
</body>
</html>
