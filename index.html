<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abol Network</title>
    <style>
        :root {
            --primary: #1d9bf0;
            --bg: #000000;
            --surface: #16181c;
            --text: #e7e9ea;
            --border: #2f3336;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto; background: var(--bg); color: var(--text); margin: 0; display: flex; justify-content: center; }
        #app { width: 100%; max-width: 600px; border-left: 1px solid var(--border); border-right: 1px solid var(--border); min-height: 100vh; display: flex; flex-direction: column; }
        
        .header { sticky; top: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); padding: 15px; font-size: 20px; font-weight: bold; border-bottom: 1px solid var(--border); z-index: 10; }
        
        /* Посты */
        #feed { flex: 1; }
        .post { padding: 15px; border-bottom: 1px solid var(--border); display: flex; gap: 12px; transition: 0.2s; }
        .post:hover { background: #080808; }
        .avatar { width: 48px; height: 48px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; flex-shrink: 0; }
        .post-content { flex: 1; }
        .post-header { display: flex; align-items: center; gap: 5px; margin-bottom: 4px; }
        .nickname { font-weight: bold; }
        .username { color: #71767b; font-size: 14px; }
        .post-text { line-height: 1.4; word-break: break-word; }
        
        /* Инпут */
        .input-area { padding: 15px; border-bottom: 8px solid #202327; }
        textarea { width: 100%; background: none; border: none; color: white; font-size: 18px; resize: none; outline: none; margin-bottom: 10px; }
        .actions { display: flex; justify-content: flex-end; border-top: 1px solid var(--border); padding-top: 10px; }
        .btn { background: var(--primary); color: white; border: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn:disabled { opacity: 0.5; }

        /* Админка */
        .admin-del { color: #f4212e; background: none; border: 1px solid #f4212e; padding: 2px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: auto; }
        
        /* Модалка входа */
        #auth-overlay { position: fixed; inset: 0; background: rgba(91, 112, 131, 0.4); display: flex; align-items: center; justify-content: center; z-index: 100; }
        .auth-card { background: black; padding: 30px; border-radius: 16px; width: 300px; text-align: center; }
        input.classic { width: 100%; padding: 12px; margin: 10px 0; background: black; border: 1px solid var(--border); color: white; border-radius: 4px; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="auth-overlay">
    <div class="auth-card">
        <h2>Войти в Abol</h2>
        <input type="text" id="nickInput" class="classic" placeholder="Ваше имя...">
        <button class="btn" onclick="login()">Начать</button>
    </div>
</div>

<div id="app">
    <div class="header">Главная</div>
    
    <div class="input-area">
        <textarea id="postInput" placeholder="Что происходит?" rows="3"></textarea>
        <div class="actions">
            <button class="btn" onclick="sendPost()">Постить</button>
        </div>
    </div>

    <div id="feed"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, limit, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBz8fnaJ_mpCE5Vv83doxBb6nTybDSBmlI",
        authDomain: "kaka-chat-39bb6.firebaseapp.com",
        projectId: "kaka-chat-39bb6",
        storageBucket: "kaka-chat-39bb6.firebasestorage.app",
        messagingSenderId: "927391255601",
        appId: "1:927391255601:web:1f83128108dc1ca2831910"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let currentUser = localStorage.getItem('abolUser') || "";
    let isAdmin = false;

    // Авторизация
    if (currentUser) document.getElementById('auth-overlay').style.display = 'none';
    window.login = () => {
        const nick = document.getElementById('nickInput').value.trim();
        if (nick) {
            currentUser = nick;
            localStorage.setItem('abolUser', nick);
            document.getElementById('auth-overlay').style.display = 'none';
        }
    };

    // Отправка поста
    window.sendPost = async () => {
        const text = document.getElementById('postInput').value.trim();
        if (!text) return;

        // Секретный вход в админку через поле ввода поста
        if (text === "/admin 3232damir4ik") {
            isAdmin = true;
            alert("Админ-панель активирована!");
            document.getElementById('postInput').value = "";
            return;
        }

        try {
            await addDoc(collection(db, "posts"), {
                user: currentUser,
                text: text,
                createdAt: serverTimestamp()
            });
            document.getElementById('postInput').value = "";
        } catch (e) { alert("Ошибка публикации"); }
    };

    // Удаление (только для админа)
    window.deletePost = async (id) => {
        if (isAdmin && confirm("Удалить этот пост?")) {
            await deleteDoc(doc(db, "posts", id));
        }
    };

    // Загрузка ленты
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"), limit(100));
    
    onSnapshot(q, (snapshot) => {
        const feed = document.getElementById('feed');
        feed.innerHTML = "";
        snapshot.forEach((postDoc) => {
            const d = postDoc.data();
            const id = postDoc.id;
            const initials = d.user ? d.user.substring(0,2).toUpperCase() : "??";
            
            const postHtml = `
                <div class="post">
                    <div class="avatar">${initials}</div>
                    <div class="post-content">
                        <div class="post-header">
                            <span class="nickname">${d.user}</span>
                            <span class="username">@${d.user.toLowerCase().replace(/\s/g, '')}</span>
                            ${isAdmin ? `<button class="admin-del" onclick="deletePost('${id}')">Удалить</button>` : ''}
                        </div>
                        <div class="post-text">${d.text}</div>
                    </div>
                </div>
            `;
            feed.insertAdjacentHTML('beforeend', postHtml);
        });
    });
</script>

</body>
</html>
